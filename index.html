<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9530763960630835"
        crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CS583DXQC7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'G-CS583DXQC7');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Review & Rating</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 10vh;
        }

        .glow-button {
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 20px rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease-in-out;
        }

        .glow-button:hover {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .input-glow:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.5), 0 0 5px rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
        }

        .animated-grid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(to right, rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: moveGrid 60s linear infinite;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes moveGrid {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 4000px 4000px;
            }
        }

        .pulsing-border-inner {
            border: 2px solid #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
            animation: pulseBorder 2s infinite alternate;
        }

        @keyframes pulseBorder {
            from {
                box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            }

            to {
                box-shadow: 0 0 20px rgba(0, 255, 255, 0.9);
            }
        }

        .digital-text-shadow {
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .star-rating .star {
            color: #4a5568;
            font-size: 1.8rem;
            transition: transform 0.2s, color 0.3s;
            cursor: default;
        }

        .star-rating .star.filled {
            color: #FFD700;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
            transform: scale(1.1);
        }

        .search-bar {
            transition: all 0.3s ease;
            color: #00ffff;
        }

        .search-bar:focus {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .dropdown-item {
            transition: all 0.2s ease;
            color: #E0E0E0;
            background-color: #1a202c;
        }

        .dropdown-item:hover {
            transform: translateX(5px);
            background: #2d3748;
            color: #00ffff;
        }

        .logo {
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.6));
        }

        .navbar-link {
            transition: color 0.3s, text-shadow 0.3s;
        }

        .navbar-link:hover {
            color: #00ffff;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.7);
        }

        .golden-glow-text {
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.6);
            font-size: 1.5rem;
            font-weight: bold;
        }

        .full-screen-section {
            min-height: calc(100vh - 80px);
            padding-top: 5rem;
            padding-bottom: 5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        #reviews {
            min-height: auto;
            padding: 0;
            background-color: transparent;
            border-bottom: none;
        }

        #reviews.full-screen-section {
            padding-top: 0;
            padding-bottom: 0;
        }

        .carousel-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            border-radius: 0.75rem;
        }

        .carousel-track {
            display: flex;
            white-space: nowrap;
            animation: scroll-left 30s linear infinite;
            will-change: transform;
            padding: 4rem 0;
        }

        .review-item {
            flex-shrink: 0;
            padding: 1rem;
            margin-right: 2.5rem;
            min-height: 220px;
            background-color: rgba(26, 32, 44, 0.9);
            border-radius: 0.5rem;
            text-align: center;
            width: calc(33.333% - 2.5rem);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        .carousel-track .review-item:not(:last-child) {
            margin-right: 2.5rem;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        @media (max-width: 1023px) {
            .review-item {
                width: calc(50% - 2rem);
                margin-right: 2rem;
            }

            .carousel-track {
                padding: 3rem 0;
            }
        }

        @media (max-width: 767px) {
            .review-item {
                width: calc(90% - 2rem);
                margin-right: 2rem;
            }

            .carousel-track {
                padding: 2rem 0;
            }
        }
        #navbar-default:not(.hidden) {
    display: flex;
    flex-direction: column;
    width: 100%;
    padding: 1rem;
}

[data-collapse-toggle="navbar-default"] {
    z-index: 60;
    width: 48px;
    height: 48px;
    padding: 8px;
}

[data-collapse-toggle="navbar-default"] svg {
    fill: currentColor;
}
    </style>
</head>

<body class="flex flex-col min-h-screen">
    <div class="animated-grid-background"></div>

    <nav id="navbar" class="sticky top-0 z-50 p-[-20vw]"></nav>

    <main id="main-content" class="flex-grow w-full relative z-10"></main>

    <footer id="footer" class="mt-auto"></footer>

<script>
    // Load navbar.html
    fetch('navbar.html')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load navbar.html');
            return response.text();
        })
        .then(data => {
            document.getElementById('navbar').innerHTML = data;
            // Initialize toggle button after navbar is loaded
            const toggleButton = document.querySelector('[data-collapse-toggle="navbar-default"]');
            const navbarMenu = document.getElementById('navbar-default');

            if (toggleButton && navbarMenu) {
                toggleButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    navbarMenu.classList.toggle('hidden');
                    const isExpanded = navbarMenu.classList.contains('hidden') ? 'false' : 'true';
                    toggleButton.setAttribute('aria-expanded', isExpanded);
                });
                toggleButton.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    navbarMenu.classList.toggle('hidden');
                    const isExpanded = navbarMenu.classList.contains('hidden') ? 'false' : 'true';
                    toggleButton.setAttribute('aria-expanded', isExpanded);
                });
            }
        })
        .catch(error => {
            console.error('Error loading navbar:', error);
            document.getElementById('navbar').innerHTML = '<p class="text-red-500 text-center">Error loading navigation bar.</p>';
        });

    // Load ffcs.html
    fetch('ffcs.html')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load ffcs.html');
            return response.text();
        })
        .then(data => {
            document.getElementById('main-content').innerHTML = data;
            // Initialize faculty search after content is loaded
            initializeFacultySearch();
            // Handle fragment navigation
            const hash = window.location.hash;
            if (hash) {
                const target = document.querySelector(hash);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                } else {
                    console.warn(`Element with ID ${hash} not found`);
                    setTimeout(() => {
                        const retryTarget = document.querySelector(hash);
                        if (retryTarget) {
                            retryTarget.scrollIntoView({ behavior: 'smooth' });
                        }
                    }, 100);
                }
            }
        })
        .catch(error => {
            console.error('Error loading ffcs.html:', error);
            document.getElementById('main-content').innerHTML = '<p class="text-red-500 text-center">Error loading content.</p>';
        });

    // Load footer.html
    fetch('footer.html')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load footer.html');
            return response.text();
        })
        .then(data => {
            document.getElementById('footer').innerHTML = data;
        })
        .catch(error => {
            console.error('Error loading footer:', error);
            document.getElementById('footer').innerHTML = '<p class="text-red-500 text-center">Error loading footer.</p>';
        });

    // This function calculates the Levenshtein distance between two strings
    function levenshtein(a, b) {
        const matrix = [];
        for (let i = 0; i <= b.length; i++) {
            matrix[i] = [i];
        }
        for (let j = 0; j <= a.length; j++) {
            matrix[0][j] = j;
        }
        for (let i = 1; i <= b.length; i++) {
            for (let j = 1; j <= a.length; j++) {
                if (b.charAt(i - 1) === a.charAt(j - 1)) {
                    matrix[i][j] = matrix[i - 1][j - 1];
                } else {
                    matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                }
            }
        }
        return matrix[b.length][a.length];
    }

    function initializeFacultySearch() {
        const searchBar = document.getElementById('searchBar');
        const dropdown = document.getElementById('dropdown');
        const facultyDetailsSection = document.getElementById('facultyDetailsSection');
        const initialPrompt = document.getElementById('initialPrompt');

        let facultyData = [];
        let searchIndex = {}; // New inverted index for faster lookups

        // Fetch faculty.json
        fetch('faculty.json')
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                facultyData = data;
                // Build the inverted index
                facultyData.forEach(faculty => {
                    const nameTokens = faculty.name.toLowerCase().split(/\s+/).filter(token => token.length > 0);
                    nameTokens.forEach(token => {
                        if (!searchIndex[token]) {
                            searchIndex[token] = [];
                        }
                        searchIndex[token].push(faculty);
                    });
                });
                if (initialPrompt) {
                    initialPrompt.textContent = "Search for a faculty member to view their dossier.";
                    initialPrompt.classList.remove('hidden');
                }
            })
            .catch(err => {
                console.error('Error loading faculty data:', err);
                if (initialPrompt) {
                    initialPrompt.textContent = "Error: Failed to load faculty data. Please check your network connection.";
                    initialPrompt.classList.remove('hidden');
                }
            });

        if (searchBar) {
            searchBar.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                dropdown.innerHTML = '';
                facultyDetailsSection.style.display = 'none';

                if (query.length === 0) {
                    dropdown.classList.add('hidden');
                    if (initialPrompt) {
                        initialPrompt.textContent = "Search for a faculty member to view their dossier.";
                        initialPrompt.classList.remove('hidden');
                    }
                    return;
                }

                const queryTokens = query.split(/\s+/).filter(token => token.length > 0);
                const matchedFacultySet = new Set();
                const matchedFaculty = [];

                // Use the inverted index for initial filtering
                queryTokens.forEach(token => {
                    // Direct token match
                    if (searchIndex[token]) {
                        searchIndex[token].forEach(faculty => {
                            if (!matchedFacultySet.has(faculty.name)) {
                                matchedFacultySet.add(faculty.name);
                                matchedFaculty.push({ ...faculty, score: 0 });
                            }
                        });
                    }
                    // Fuzzy match for tokens
                    for (const indexToken in searchIndex) {
                        if (levenshtein(token, indexToken) <= 2) {
                            searchIndex[indexToken].forEach(faculty => {
                                if (!matchedFacultySet.has(faculty.name)) {
                                    matchedFacultySet.add(faculty.name);
                                    matchedFaculty.push({ ...faculty, score: 0 });
                                }
                            });
                        }
                    }
                });

                // Re-calculate scores for sorting
                matchedFaculty.forEach(faculty => {
                    const name = faculty.name.toLowerCase();
                    faculty.score = queryTokens.reduce((score, token) => {
                        let tokenScore = 0;
                        if (name.includes(token)) {
                            tokenScore += 2; // High score for substring match
                        }
                        if (name.split(/\s+/).some(nameToken => levenshtein(token, nameToken) <= 2)) {
                            tokenScore += 1; // Lower score for fuzzy match
                        }
                        return score + tokenScore;
                    }, 0);
                });

                // Sort results by relevance (highest score first) and then alphabetically
                matchedFaculty.sort((a, b) => b.score - a.score || a.name.localeCompare(b.name));

                if (matchedFaculty.length > 0) {
                    dropdown.classList.remove('hidden');
                    if (initialPrompt) initialPrompt.classList.add('hidden');
                    matchedFaculty.forEach(faculty => {
                        const item = document.createElement('div');
                        item.classList.add('dropdown-item', 'p-3', 'cursor-pointer', 'text-white', 'hover:bg-gray-700', 'rounded-md');
                        item.innerHTML = `<span class="text-teal-300 font-semibold">${faculty.name}</span> <span class="text-gray-400">(${faculty.rating}‚≠ê)</span>`;
                        item.addEventListener('click', () => {
                            searchBar.value = faculty.name;
                            dropdown.classList.add('hidden');
                            showFacultyDetails(faculty);
                        });
                        dropdown.appendChild(item);
                    });
                } else {
                    dropdown.classList.add('hidden');
                    if (initialPrompt) {
                        initialPrompt.textContent = "No faculty found matching your search criteria.";
                        initialPrompt.classList.remove('hidden');
                    }
                }
            });
        }

        if (document) {
            document.addEventListener('click', (e) => {
                if (!searchBar.contains(e.target) && !dropdown.contains(e.target) && !facultyDetailsSection.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
        }

        const renewSearchButton = document.getElementById('renewSearchButton');
        if (renewSearchButton) {
            renewSearchButton.addEventListener('click', () => {
                searchBar.value = '';
                dropdown.innerHTML = '';
                dropdown.classList.add('hidden');
                facultyDetailsSection.style.display = 'none';
                if (initialPrompt) {
                    initialPrompt.textContent = "Search for a faculty member to view their dossier.";
                    initialPrompt.classList.remove('hidden');
                }
                searchBar.focus();
            });
        }

        function showFacultyDetails(faculty) {
            const facultyName = document.getElementById('facultyName');
            const rating = document.getElementById('rating');
            const reviewContent = document.getElementById('reviewContent');
            const finalRemark = document.getElementById('finalRemark');

            facultyName.textContent = faculty.name;
            rating.innerHTML = generateStars(faculty.rating);
            reviewContent.innerHTML = '';
            finalRemark.textContent = '';
            finalRemark.classList.remove('golden-glow-text');

            const reviewParts = faculty.review.split(', ');
            let finalRemarkValue = '';

            reviewParts.forEach(part => {
                if (part.startsWith("Final Remark:")) {
                    finalRemarkValue = part.replace("Final Remark:", "").trim();
                } else {
                    const p = document.createElement('p');
                    p.classList.add('mb-1', 'text-left');
                    p.textContent = part + (part.endsWith('.') || part.endsWith('üôÇ') ? '' : '.');
                    reviewContent.appendChild(p);
                }
            });

            if (finalRemarkValue) {
                finalRemark.textContent = finalRemarkValue;
                finalRemark.classList.add('golden-glow-text');
            }

            if (initialPrompt) {
                initialPrompt.classList.add('hidden');
            }

            facultyDetailsSection.style.display = 'block';
        }

        function generateStars(ratingValue) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += `<span class="star ${i <= Math.round(ratingValue) ? 'filled' : ''}">&#9733;</span>`;
            }
            return starsHtml;
        }

        if (initialPrompt) {
            initialPrompt.classList.remove('hidden');
            facultyDetailsSection.style.display = 'none';
        }
    }
</script>
</body>

</html>